"use strict";(self.webpackChunkcase_study=self.webpackChunkcase_study||[]).push([[410],{5410:(Y,h,i)=>{i.r(h),i.d(h,{UsuarioModule:()=>M});var m=i(6895),d=i(9197),n=i(4006),F=i(5226),f=i.n(F),t=i(4650),C=i(7266),v=i(9019),Z=i(529);let _=(()=>{class o{constructor(e){this.http=e,this.baseUrl=v.N.baseUrl,this.urlCloudinary=v.N.urlCloudinary}editarUsuario({name:e,username:r,password:a,email:u,image:l,idImage:p},g){return this.http.put(`${this.baseUrl}/usuarios/${g}`,{name:e,username:r,password:a,email:u,image:l,idImage:p})}subirImagen(e){return this.http.post(this.urlCloudinary,e)}eliminarImagen(e){return this.http.delete(`${this.baseUrl}/cloudinary/deleteImagen/${e}`)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(Z.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var w=i(4859),b=i(9549),x=i(7392),I=i(4144),T=i(3162),c=i(8997);function U(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div"),t._UZ(1,"img",12)(2,"br"),t.TgZ(3,"div")(4,"button",13),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cambiar())}),t.TgZ(5,"mat-icon"),t._uU(6,"change_circle"),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("src",e.usuario.imagen,t.LSH),t.xp6(3),t.Q6J("disabled",e.cargando)}}function E(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"ngx-dropzone-image-preview",17),t.NdJ("removed",function(){const u=t.CHM(e).$implicit,l=t.oxw(2);return t.KtG(l.quitarImagen(u))}),t.qZA()}2&o&&t.Q6J("file",s.$implicit)("removable",!0)}function y(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",14)(1,"ngx-dropzone",15),t.NdJ("change",function(a){t.CHM(e);const u=t.oxw();return t.KtG(u.seleccionaImagen(a))}),t.TgZ(2,"ngx-dropzone-label"),t._uU(3,"Click o arrastra tu imagen "),t.TgZ(4,"mat-icon"),t._uU(5,"insert_photo"),t.qZA()(),t.YNc(6,E,1,2,"ngx-dropzone-image-preview",16),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"div")(9,"button",10),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.subirImagen())}),t._uU(10," Subir foto "),t.TgZ(11,"mat-icon"),t._uU(12,"file_upload"),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.files),t.xp6(3),t.Q6J("disabled",e.cargando||e.files.length<1||""!==e.idFoto)}}function J(o,s){1&o&&t._UZ(0,"mat-progress-bar",18)}let N=(()=>{class o{constructor(e,r,a,u){this.fb=e,this.authService=r,this.router=a,this.usuarioService=u,this.cargando=!1,this.files=[],this.foto="",this.idFoto="",this.cambiarImagen=!1,this.user={id:this.usuario.id,name:"",username:this.usuario.usuario,password:null,email:this.usuario.correo,image:null,intentos:0,createAt:new Date,enabled:!0,roles:this.usuario.rol,idImage:null},this.miFormulario=this.fb.group({password:[""],password2:[""],nombre:[this.usuario.nombre,[n.kI.required]]})}get usuario(){return this.authService.usuario}verificarPassword(){this.miFormulario.get("password")?.value.length>0&&this.miFormulario.get("password")?.value.length<5?this.miFormulario.get("password")?.setErrors({contrasenaCorta:!0}):this.miFormulario.get("password")?.setErrors(null),this.miFormulario.get("password2")?.value.length>0&&this.miFormulario.get("password2")?.value.length<5?this.miFormulario.get("password2")?.setErrors({contrasenaCorta:!0}):this.miFormulario.get("password2")?.setErrors(null),this.miFormulario.get("password")?.value===this.miFormulario.get("password2")?.value?this.miFormulario.get("password2")?.setErrors(null):this.miFormulario.get("password2")?.setErrors({noEsIgual:!0})}editar(){this.cargando=!0,this.user.name=this.miFormulario.value.nombre,this.user.password=this.miFormulario.value.password,this.cambiarImagen&&(this.user.image=this.foto,this.user.idImage=this.idFoto),this.usuarioService.editarUsuario(this.user,this.usuario.id).subscribe(e=>{if(e.ok){f().fire("Exito!",`Usuario ${this.usuario.nombre} editado con exito`,"success");const{id:r,name:a,username:u,image:l,roles:p,email:g}=e.usuario;this.usuario.id=r,this.usuario.usuario=u,this.usuario.nombre=a,this.usuario.imagen=l,this.usuario.rol=p,this.usuario.correo=g,localStorage.setItem("usuario",JSON.stringify(this.usuario)),this.router.navigate(["/productos/comprar"])}else f().fire("Error, ",e.mensaje,"error");this.cargando=!1})}subirImagen(){if(this.cargando=!0,this.idFoto)this.cargando=!1;else{if(!this.files[0])return void(this.cargando=!1);const e=this.files[0],r=new FormData;r.append("file",e),r.append("upload_preset","g29k4pwe"),r.append("cloud_name","djxpuwlz0"),this.usuarioService.subirImagen(r).subscribe(a=>{this.foto=a.url,this.idFoto=a.public_id,this.cargando=!1})}}seleccionaImagen(e){this.files.push(...e.addedFiles),this.files.length>1&&this.files.shift()}quitarImagen(e){this.cargando=!0,this.files.splice(this.files.indexOf(e),1),this.idFoto&&this.usuarioService.eliminarImagen(this.idFoto).subscribe(console.log),this.foto="",this.idFoto="",this.cargando=!1,this.cambiarImagen=!1}cambiar(){this.cambiarImagen=!0}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(n.qu),t.Y36(C.e),t.Y36(d.F0),t.Y36(_))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-editar"]],decls:27,vars:6,consts:[[1,"container","justify-content-center","text-center","row","mt-5"],[1,"login100-form-title","p-b-49","p-t-30","text-white"],[1,"col-5"],[1,"row","justify-content-center"],[4,"ngIf"],["class","col-9 justify-content-center",4,"ngIf"],[1,"row","mt-3",3,"formGroup","ngSubmit"],["type","text","formControlName","nombre","matInput","","required","","placeholder","Ingrese su nombre"],["type","password","formControlName","password","matInput","","placeholder","Ingrese su contrase\xf1a",3,"input"],["type","password","formControlName","password2","matInput","","placeholder","verifique su contrase\xf1a",3,"input"],["mat-raised-button","","color","primary",3,"disabled","click"],["mode","indeterminate",4,"ngIf"],[1,"img-fluid","img-edit","col-6",3,"src"],["mat-raised-button","","mat-mini-fab","","color","primary",1,"position-absolute","top-1","start-1","translate-middle-y",3,"disabled","click"],[1,"col-9","justify-content-center"],[3,"change"],["ngProjectAs","ngx-dropzone-preview",5,["ngx-dropzone-preview"],3,"file","removable","removed",4,"ngFor","ngForOf"],["ngProjectAs","ngx-dropzone-preview",5,["ngx-dropzone-preview"],3,"file","removable","removed"],["mode","indeterminate"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"span",1),t._uU(2),t.qZA(),t.TgZ(3,"div",2)(4,"div",3),t.YNc(5,U,7,2,"div",4),t.YNc(6,y,13,2,"div",5),t.qZA(),t.TgZ(7,"form",6),t.NdJ("ngSubmit",function(){return r.editar()}),t.TgZ(8,"mat-form-field")(9,"mat-label"),t._uU(10,"Nombre"),t.qZA(),t._UZ(11,"input",7),t.qZA(),t.TgZ(12,"mat-form-field")(13,"mat-label"),t._uU(14,"Contrase\xf1a"),t.qZA(),t.TgZ(15,"input",8),t.NdJ("input",function(){return r.verificarPassword()}),t.qZA()(),t.TgZ(16,"mat-form-field")(17,"mat-label"),t._uU(18,"Verificar contrase\xf1a"),t.qZA(),t.TgZ(19,"input",9),t.NdJ("input",function(){return r.verificarPassword()}),t.qZA()(),t.TgZ(20,"button",10),t.NdJ("click",function(){return r.editar()}),t.TgZ(21,"mat-icon"),t._uU(22,"edit"),t.qZA(),t._uU(23," Editar "),t.qZA()()()(),t._UZ(24,"br")(25,"br"),t.YNc(26,J,1,0,"mat-progress-bar",11)),2&e&&(t.xp6(2),t.hij("Editar a ",r.usuario.usuario,""),t.xp6(3),t.Q6J("ngIf",!r.cambiarImagen),t.xp6(1),t.Q6J("ngIf",r.cambiarImagen),t.xp6(1),t.Q6J("formGroup",r.miFormulario),t.xp6(13),t.Q6J("disabled",r.miFormulario.invalid||r.cargando),t.xp6(6),t.Q6J("ngIf",r.cargando))},dependencies:[m.sg,m.O5,w.lW,b.KE,b.hX,x.Hw,I.Nt,T.pW,c._f,c.NP,c.sv,n._Y,n.Fj,n.JJ,n.JL,n.Q7,n.sg,n.u],encapsulation:2}),o})();var S=i(123);const A=[{path:"",component:(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-home"]],decls:1,vars:0,template:function(e,r){1&e&&t._UZ(0,"app-home-page")},dependencies:[S.h],encapsulation:2}),o})(),children:[{path:"editar",component:N},{path:"**",redirectTo:"editar"}]}];let z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.Bz.forChild(A),d.Bz]}),o})();var j=i(2041),H=i(4466);let M=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.ez,z,j.q,H.m]}),o})()}}]);